<div id="hostBill" ng-cloak>
  <button ng-click="hostBill.goToGuestBill()" class="guestBill">See Your Individual Bill</button>
  <h1>Final Bill For Everyone</h1>

  <div ng-repeat="dish in hostBill.data.dishes">

    <div ng-if="dish.users.length !== 0">
      <h3>{{ _.capitalize(dish.name)}}</h3>

      <p>Cost: {{dish.cost | currency }}</p>

      <p><small>Each individual paid: {{ hostBill.getDishIndivCost(dish) | currency }}</small></p>

      <span>
        <!-- slow! need to refactor.-->
        <span>{{ hostBill.getUsersByDish(dish, hostBill.data.users) }}</span> got this.
        <!-- {{ _.map(_.pluck(hostBill.getUsersByDish(dish, hostBill.data.users), 'username'), _.capitalize).join(", ") }} got this. -->
        <!-- {{ _.map(_.pluck(dish.userSummary, 'username'), _.capitalize).join(", ") }} got this. -->
      </span>
    </div>
  </div>
  <br><br>
  <div>

    <form name="billForm">

      <div class="subtotal">
        <h2>Subtotal:</h2>
        {{ hostBill.getSubTotal(hostBill.data.dishes) | currency}}
      </div>

      <div class="tip">
        <h3>Tip:</h3>
        <input name="tip" type="number" ng-model="hostBill.tip" placeholder="0%" min="0" aria-label="tip">%

        <article class="tip">
          Your added tip:
          <span ng-show="billForm.tip.$pristine">
            {{ 0 + hostBill.tip | currency }}
          </span>
          <span ng-show="billForm.tip.$dirty" id="currency-default">
            {{ hostBill.tip * 0.01 * hostBill.getSubTotal(hostBill.data.dishes) | currency}}
          </span>
        </article>
      </div>

      <div class="tax">
        <h3>Tax:</h3>
        <input name="tax" type="number" ng-model="hostBill.tax" placeholder="0%" aria-label="tax" min="0" max="100">
        <article class="tax">
          Your added tax:
          <span ng-show="billForm.tax.$pristine">
            {{ 0 + hostBill.tax | currency }}
          </span>
          <span ng-show="billForm.tax.$dirty" id="currency-default">
            {{ hostBill.tax * 0.01 * hostBill.getSubTotal(hostBill.data.dishes)  | currency}}
          </span>
        </article>
      </div>


      <div class="grandTotal">
        <h2>Grand Total</h2>
        <span ng-show="billForm.tip.$pristine && billForm.tip.$pristine">
          {{ hostBill.getSubTotal(hostBill.data.dishes) | currency}}
        </span>
        <span ng-show="billForm.tip.$dirty && billForm.tax.$pristine">
          {{ hostBill.getSubTotal(hostBill.data.dishes) +
          (hostBill.tip * 0.01 * hostBill.getSubTotal(hostBill.data.dishes)) | currency }}
        </span>
        <span ng-show="billForm.tip.$dirty && billForm.tax.$dirty">
          {{ hostBill.getSubTotal(hostBill.data.dishes) +
          (hostBill.tip * 0.01 * hostBill.getSubTotal(hostBill.data.dishes)) +
          (hostBill.tax * 0.01 * hostBill.getSubTotal(hostBill.data.dishes)) | currency }}
        </span>
      </div>

      <br>

      <input ng-show="billForm.tip.$dirty && billForm.tax.$dirty" type="submit" value="Send Bills to Guests" ng-click="hostBill.sendBillsToGuests()">

      <br>

      <span ng-show="hostBill.billsSent">
        Your bills were sent to your guests successfully!
      </span>
    </form>
    <br>
  </div>
</div>
