<div id="guestBill" ng-cloak>
  <button ng-click="guestBill.goToAllDishes()" class="allDishes">See All Dishes</button>
  <button ng-show="guestBill.isHost" ng-click="guestBill.goToHostBill()" class="hostBill">See Final Bill</button>
  <h1>{{ _.capitalize(guestBill.username) }}'s Total Bill</h1>


  <!-- <div ng-repeat="dish in guestBill.data.dishes"> -->
  <div ng-repeat="dish in guestBill.getGuestDishes(guestBill.user_id, guestBill.data.dishes)">
    <h2>{{_.capitalize(dish.name)}}</h2>
    <p>Your portion: {{ guestBill.getDishIndivCost(dish) | currency }}</p>
    <small>Total Cost</small>
    <span><small>
      {{ dish.cost | currency }}
    </small></span>
    <article>
      <p ng-if="dish.users.length !== 1">
        <strong>You shared this with</strong>
        <!-- <p ng-repeat="person in guestBill.data.users"> -->
        <!-- <span ng-if="guestBill.isDishSharedWithThisOtherUser(person.id, dish) && person.id !== guestBill.user_id"> -->
        {{ guestBill.getOtherUsersByUsername(dish, guestBill.data.users, guestBill.user_id) }}.
        <!-- <span>{{ _.capitalize(person.username) }}</span> -->
        <!-- </span> -->
        <!-- </p> -->

        <!-- or -->
        <!-- <p ng-show="guestBill.isDishShared(guestBill.user_id, dish)" ng-repeat="person in guestBill.getOtherSharedUserForDish(guestBill.user_id, dish, guestBill.data.users) ">
          <span>{{ _.capitalize(person.username) }}</span>
        </p> -->
      </p>
      <p ng-if="dish.users.length === 1">
        <span>Only you ate this.</span>
      </p>
    </article>
  </div>

  <br>

  <h1>Your Subtotal</h1>
  <h2>{{guestBill.getGuestTotal(guestBill.data) | currency}}</h2>

  <div ng-if="_.isEmpty(guestBill.data.billData) && !guestBill.isHost">
    Your host hasn't decided on the tip and tax yet. Please check again later.
  </div>

  <div ng-if="!_.isEmpty(guestBill.data.billData) && !guestBill.isHost">
    <h3>Tax</h3>
    <p>{{guestBill.guestTax | currency}}</p>
    <small>You were charged {{ guestBill.data.billData.taxPercent }}% for tax.</small>
    <h3>Tip</h3>
    <p>{{guestBill.guestTip | currency}}</p>
    <small>Your host chose {{ guestBill.data.billData.tipPercent }}% for tip.</small>
    <h2>Your Total</h2>
    <p>{{guestBill.guestGrandTotal | currency}}</p>
    <small>(Dinner Grand Total: {{  guestBill.data.billData.grandTotal | currency}})</small>
  </div>

  <br><br>
</div>
